{
	"version": "0.1",
	"name": "Authzed",
	"scopeName": "source.authzed",
  "foldingStartMarker": "\\{\\s*$",
  "foldingStopMarker": "^\\s*\\}",
	"patterns": [
    { "include": "#comment" },
    { "include": "#objectDefinition" },
    { "include": "#objectRelation" }
	],
	"repository": {
    "comment": {
      "patterns": [
        { "include": "#lineComment" },
        { "include": "#blockComment" }
      ],
      "repository": {
        "lineComment": {
          "patterns": [
            { "include": "#doubleSlashLineComment" },
            { "include": "#slashDotLineComment" }
          ],
          "repository": {
            "doubleSlashLineComment": {
              "match": "\\/\\/.*",
              "name": "comment.line.double-slash.authzed"
            },
            "slashDotLineComment": {
              "match": "\\/\\*.*\\*\\/",
              "name": "comment.line.authzed"
            }
          }
        },
        "blockComment": {
          "begin": "\\/\\*",
          "end": "\\*\\/",
          "name": "comment.block.authzed"
        }
      }
    },
    "objectDefinition": {
      "patterns": [
        {
          "captures": {
            "1": {
              "name": "keyword.control.class.authzed"
            },
            "2": {
              "name": "comment.line.authzed"
            },
            "3": {
              "name": "entity.name.type.class.authzed"
            },
            "4": {
              "name": "variable.parameter.authzed"
            },
            "5": {
              "name": "storage.type.authzed"
            }
          },
          "match": "^\\s*(definition|caveat)\\s+(\\w+\/|)(\\w+)(\\(((\\w+)\\s*)+\\)|)\\s{(}|)",
          "name": "entity.name.function.authzed"
        }
      ]
    },
    "objectRelation": {
      "patterns": [
        {
          "captures": {
            "1": {
              "comment": "relation",
              "name": "entity.name.function.authzed"
            },
            "2": {
              "comment": "precursor word (# or /)",
              "name": "comment.line.authzed"
            },
            "3": {
              "comment": "colon",
              "name": "keyword.operator.assign.authzed"
            },
            "4": {
              "name": "storage.type.authzed"
            }
          },
          "match": "^\\s*(relation)\\s+((?:\\w+\/)|(?:\\w+#)|)\\w+(:)(\\s+((?:\\w+\/)|(?:\\w+#)|)\\w+(\\s+(\\|)|))+?"
        }
      ]
    },

    "operator": {
      "comment": "== comparison, = equal, : assign, | or, + union, & intersection, - exclusion, -> arrow",
      "patterns": [
        { "include": "#comparison" },
        { "include": "#equal" },
        { "include": "#assign" },
        { "include": "#or" },
        { "include": "#union" },
        { "include": "#intersection" },
        { "include": "#exclusion" },
        { "include": "#arrow" }
      ],
      "repository": {
        "comparison": {
          "match": "\\s==\\s",
          "name": "keyword.operator.comparison.authzed"
        },
        "equal": {
          "match": "\\s=\\s",
          "name": "keyword.operator.equal.authzed"
        },
        "assign": {
          "match": ":\\s",
          "name": "keyword.operator.assign.authzed"
        },
        "or": {
          "match": "\\s\\|\\s",
          "name": "storage.type.authzed"
        },
        "union": {
          "match": "\\s+\\s",
          "name": "keyword.operator.union.authzed"
        },
        "intersection": {
          "match": "\\s&\\s",
          "name": "keyword.operator.intersection.authzed"
        },
        "exclusion": {
          "match": "\\s-\\s",
          "name": "keyword.operator.exclusion.authzed"
        },
        "arrow": {
          "match": "(->)",
          "name": "keyword.operator.arrow.authzed"
        }
      }
    },
    "class": {
      "comment": "Object Definitions are similar to a class definition in an Object Oriented programming language.",
      "patterns": [
        { "include": "#definition" },
        { "include": "#relation" },
        { "include": "#permission" }
      ],
      "repository": {
        "definition": {
          "match": "^(definition|caveat)\\s",
          "name": "keyword.control.class.authzed"
        },
        "relation": {
          "match": "^\\s{1,4}relation\\s",
          "name": "entity.name.type.authzed"
        },
        "permission": {
          "match": "^\\s{1,4}permission\\s",
          "name": "entity.name.function.authzed"
        }
      }
    },
    "variable": {
      "comment": "a final catch-all for words not otherwise captured by another scope",
      "match": "\\w*",
      "name": "variable.authzed"
    }
  }
}
